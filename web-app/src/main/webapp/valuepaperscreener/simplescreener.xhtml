<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	template="/WEB-INF/templates/template.xhtml">

	<!-- content -->
	<ui:define name="body">
	
	<h:form id="searchValuePapers">
	 <p:tabView>
        <p:tab title="Einfache Aktiensuche">
	 
			<h:panelGrid columns="2" cellpadding="10">		
				<p:outputLabel for="type" value="Wähle Aktientyp: " style="padding: 10px;"/>
				<p:selectOneMenu id="type" value="#{valuePaperScreenerBean.valuePaperType}" style="width:200px">
					<f:selectItem itemLabel="Beliebig" itemValue="#{null}" />
					<f:selectItems value="#{valuePaperScreenerBean.valuePaperTypes}" />
					<p:ajax process="@this" update=":filterTable:attributeSelect" />
				</p:selectOneMenu>
			</h:panelGrid>
			
			<p:separator />
			
			<h:dataTable id="filterTable" var="filter" value="#{valuePaperScreenerBean.filters}"  cellpadding="10">
				<p:column>
				        <p:commandButton type="button" action="#{valuePaperScreenerBean.delete(filter)}" update="filterTable" icon="ui-icon-trash" ajax="true" />
				</p:column>
				<p:column>
				    <p:selectOneMenu id="attributeSelect" value="#{filter.attribute}" style="width:200px" required="true">				
						 <f:selectItem itemLabel="Wähle Filterattribut" itemValue="#{null}" noSelectionOption="true" />
						<f:selectItems value="#{valuePaperScreenerBean.attributeTypes}" var="attribute"
						itemValue="#{attribute}" itemLabel="#{attribute.label}"/>
						<p:ajax process="@this" update="operatorCol numericCol textCol currencyCol enableCol" />
					</p:selectOneMenu>
				</p:column>
				<p:column id="operatorCol" rendered="#{filter.numeric and filter.attribute != null}">
				    <p:selectOneMenu id="operator" value="#{filter.operator}" style="width:200px">				
						<f:selectItems value="#{valuePaperScreenerBean.operatorTypes}" var="operator"
						itemValue="#{operator}" itemLabel="#{operator.label}"/>
					</p:selectOneMenu>
				</p:column>
				<p:column id="numericCol" rendered="#{filter.numeric and filter.attribute != null}">
				    <p:inputText id="nummericField" value="#{filter.numericValue}" required="true">
				    	 <f:validateRegex pattern="[0-9]" />
				    </p:inputText>
				</p:column>
				<p:column id="textCol" rendered="#{!filter.numeric and filter.attribute != null}">
				    <p:inputText id="textField" value="#{filter.textValue}" required="true"/>
				</p:column>
				<p:column id="currencyCol" rendered="#{!filter.numeric and filter.attribute == 'CURRENCY' and filter.attribute != null}">
				    <p:inputText id="currencyField" value="#{filter.currencyValue}" required="true">
				    	 <f:validateRegex pattern="^[a-zA-Z]{3}$" />
				    </p:inputText>
				</p:column>
				<p:column id="enableCol" rendered="#{filter.attribute != null}">
				   <p:selectBooleanCheckbox value="#{filter.enabled}" />
				</p:column>			
			</h:dataTable>
			<p:commandButton value="Hinzufügen"
						action="#{valuePaperScreenerBean.addFilter()}" update="filterTable"
						ajax="true" />
		</p:tab>
		 <p:tab title="Komplexe Aktiensuche">
		 </p:tab>
	</p:tabView>	
		<!-- 
				<p:outputLabel for="isin" value="ISIN: " style="padding: 10px;"/>
				<p:inputText id="isin"
					value="#{valuePaperScreenerBean.isin}" >
				 <f:validateRegex pattern="^([a-zA-Z]|\?|\*){2}([a-zA-Z0-9]|\?|\*)*" />
				</p:inputText>
		
				<p:outputLabel for="country" value="Land: " style="padding: 10px;"/>
				<p:inputText id="country" value="#{valuePaperScreenerBean.country}" />

				<p:outputLabel for="currency" value="Währungscode: " style="padding: 10px;"/>
				<p:inputText id="currency"
					value="#{valuePaperScreenerBean.currencyCode}" >
					 <f:validateRegex pattern="^[a-zA-Z]{3}$" />
				</p:inputText>			
			-->
		
				<center>
					<p:commandButton value="Reset" type="reset" />
					<p:commandButton value="Suche"
						action="#{valuePaperScreenerBean.search()}" update="searchValuePapers"
						ajax="true" />
					</center>
				<br/>
				
				<p:message for="attributeSelect" style="color:red" />
				<p> </p>
				<p:message for="nummericField" style="color:red" />
				<p> </p>
				<p:message for="textField" style="color:red" />
				<p> </p>
				<p:message for="currencyField" style="color:red" />

		<p:separator />
		
		<p:dataTable var="valuePaper" value="#{valuePaperScreenerBean.searchedValuePapers}">
				    <p:column headerText="Name" sortBy="#{valuePaper.name}">
				        <h:outputText value="#{valuePaper.name}" />
				    </p:column>
				    <p:column headerText="Währung" sortBy="#{valuePaper.currency.currencyCode}">
				        <h:outputText value="#{valuePaper.currency.currencyCode} (#{valuePaper.currency.symbol})" rendered="#{valuePaper.type == 'STOCK'}"/>
				    </p:column>
				    <p:column headerText="Land" sortBy="#{valuePaper.country}">
				        <h:outputText value="#{valuePaper.country}"  rendered="#{valuePaper.type == 'STOCK'}"/>
				    </p:column>
				    <p:column headerText="ISIN" sortBy="#{valuePaper.code}">
				        <h:outputText value="#{valuePaper.code}" />
				    </p:column>
				    <p:column headerText="Typ" sortBy="#{valuePaper.type}">
				        <h:outputText value="#{valuePaper.type}" />
				    </p:column>
				    <p:column >
				    	<h:button value="Details" outcome="/valuepaper/valuepaperview">
							<!--  includeViewParams="true" -->
							<f:param name="valuePaperIsin" value="#{valuePaper.code}" />
						</h:button> 
				    </p:column>
				</p:dataTable>
			</h:form>
	</ui:define>
	<!-- content -->

</ui:composition>
