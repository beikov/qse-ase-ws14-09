<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	template="/WEB-INF/templates/template.xhtml">

	<ui:define name="body">

		<f:metadata>

			<f:viewParam name="valuePaperIsin"
				value="#{valuePaperViewBean.valuePaperIsin}" required="true" />
			<f:viewAction action="#{valuePaperViewBean.init}" />

		</f:metadata>

		<h:form id="einzeltitelansicht">

			<h3 style="margin-top: 0">Einzeltitelansicht</h3>

			<c:choose>
				<c:when test="#{valuePaperViewBean.valuePaper != null}">

					<p:layout>
						<p:layoutUnit position="center" style="border: 0">

							<p:panel id="allgemein" header="Allgemeine Informationen"
								style="margin-bottom: 5px">

								<p:panelGrid columns="2">

									<c:forEach var="attribute"
										items="#{valuePaperViewBean.mainValuePaperAttributes}">
										<h:outputText value="#{attribute.key}"
											style="font-weight:bold" />
										<h:outputText value="#{attribute.value}" />
									</c:forEach>

									<c:if test="#{valuePaperViewBean.valuePaper.type == 'BOND'}">
										<c:if
											test="#{valuePaperViewBean.valuePaper.baseStock != null}">
											<h:outputText value="Basis-Aktie" style="font-weight:bold" />
											<h:button value="Zur Basis-Aktie" outcome="valuepaperview">
												<f:param name="valuePaperIsin"
													value="#{valuePaperViewBean.valuePaper.baseStock.code}" />
											</h:button>
										</c:if>
									</c:if>

								</p:panelGrid>

							</p:panel>

							<p:panel id="zusaetzlich" header="ZusÃ¤tzliche Informationen"
								rendered="#{valuePaperViewBean.additionalValuePaperAttributes.size() > 0}">

								<p:panelGrid columns="2">
									<c:forEach var="attribute"
										items="#{valuePaperViewBean.additionalValuePaperAttributes}">
										<h:outputText value="#{attribute.key}"
											style="font-weight:bold" />

										<c:choose>
											<c:when test="#{attribute.value.startsWith('http')}">
												<!-- <p:button value="Link" target="#{attribute.value}"/> -->
												<h:outputLink value="#{attribute.value}"
													style="text-decoration:underline;color:blue">Link</h:outputLink>
											</c:when>
											<c:otherwise>
												<h:outputText value="#{attribute.value}" />
											</c:otherwise>
										</c:choose>

									</c:forEach>
								</p:panelGrid>

							</p:panel>

						</p:layoutUnit>

						<p:layoutUnit position="east" resizable="true" size="500"
							minSize="50" maxSize="500" style="border: 0">

							<p:panel id="kurschart" header="Kurschart"
								style="margin-bottom: 5px">

								<c:choose>
									<c:when
										test="#{valuePaperViewBean.valuePaperHistoricPriceLineChartModel != null}">
										<p:chart type="line"
											model="#{valuePaperViewBean.valuePaperHistoricPriceLineChartModel}"
											style="height:400px;" />
									</c:when>

									<c:otherwise>
										<h:outputText value="keine Kursdaten vorhanden" />
									</c:otherwise>
								</c:choose>

							</p:panel>


							<p:dataList value="#{valuePaperViewBean.newsItemsList}"
								var="news" type="unordered" itemType="none" paginator="true"
								rows="5">
								<f:facet name="header">
            						News
        						</f:facet>
								<p:commandLink update=":einzeltitelansicht:newsDetail"
									oncomplete="PF('newsDialog').show()" title="News anzeigen">
									<f:setPropertyActionListener value="#{news}"
										target="#{valuePaperViewBean.selectedNewsItem}" />
									<h:outputText value="#{news.created.time}">
										<f:convertDateTime pattern="dd.MM.yyyy" />
									</h:outputText>
									<h:outputText value=", #{news.title}" />
								</p:commandLink>
								<h:outputText value="." />
							</p:dataList>

							<p:dialog header="News Info" widgetVar="newsDialog" modal="false"
								showEffect="blind" hideEffect="blind" resizable="false"
								width="700px">
								<p:outputPanel id="newsDetail" style="text-align:left;">

									<p:panelGrid columns="2">


										<h:outputText value="Datum:" />
										<h:outputText
											value="#{valuePaperViewBean.selectedNewsItem.created.time}"
											style="display:inline-block">
											<f:convertDateTime pattern="dd.MM.yyyy" />
										</h:outputText>

										<h:outputText value="Titel" />
										<h:outputText
											value="#{valuePaperViewBean.selectedNewsItem.title}" />

										<h:outputText value="Text:" />
										<h:outputText
											value="#{valuePaperViewBean.selectedNewsItem.text}" />

										<h:outputText value="Quelle:" />
										<h:outputText
											value="#{valuePaperViewBean.selectedNewsItem.source}" />
									</p:panelGrid>

								</p:outputPanel>
							</p:dialog>

							<p:panel id="analystOpinions" header="Anaylystenmeinungen">
							Meinungen
						</p:panel>

						</p:layoutUnit>
					</p:layout>

				</c:when>

				<c:otherwise>
					<h:outputText value="Wertpapier-ISIN existiert nicht" />
				</c:otherwise>

			</c:choose>
		</h:form>

	</ui:define>

</ui:composition>
