<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	template="/WEB-INF/templates/template.xhtml">

	<ui:define name="body">

		<f:metadata>

			<f:viewParam name="stockMarketGameId"
				value="#{stockMarketGameCreationBean.stockMarketGameId}"
				required="false" />
			<f:viewAction action="#{stockMarketGameCreationBean.init()}" />

		</f:metadata>

		<h:form id="stockmarketgame_create" enctype="multipart/form-data">
			<c:choose>
				<c:when
					test="#{stockMarketGameCreationBean.userInstitution != null}">

					<c:choose>
						<c:when test="#{stockMarketGameCreationBean.stockMarketGameAdmin}">

							<p:growl id="messages" showDetail="true" />

							<div class="row" style="margin-bottom: 15px;">
								<div class="col-md-7">

									<p:panel header="Börsenspiel-Einstellungen">
										<h:panelGrid columns="2" cellpadding="5">
											<p:outputLabel for="name" value="Börsenspielbezeichnung:"
												style="margin-right:5px" />
											<p:inputText id="name"
												value="#{stockMarketGameCreationBean.name}" required="true"
												style="width:396px;margin-bottom:5px">
											</p:inputText>

											<p:outputLabel for="text" value="Beschreibung:"
												style="margin-right:5px" />
											<p:inputText id="text"
												value="#{stockMarketGameCreationBean.text}" required="true"
												style="width:396px;margin-bottom:5px">
											</p:inputText>

											<p:outputLabel for="validFrom" value="Spiel beginnt am:"
												style="margin-right:5px" />
											<p:outputPanel style="margin-bottom:5px">
												<p:calendar id="validFrom"
													value="#{stockMarketGameCreationBean.validFrom}"
													required="true" size="53" />
											</p:outputPanel>

											<p:outputLabel for="validTo" value="Spiel endet am:"
												style="margin-right:5px" />
											<p:outputPanel style="margin-bottom:5px">
												<p:calendar id="validTo"
													value="#{stockMarketGameCreationBean.validTo}"
													required="true" size="53" />
											</p:outputPanel>

											<p:outputLabel for="registrationFrom"
												value="Registrierung beginnt am:" style="margin-right:5px" />
											<p:outputPanel style="margin-bottom:5px">
												<p:calendar id="registrationFrom"
													value="#{stockMarketGameCreationBean.registrationFrom}"
													required="true" size="53" />
											</p:outputPanel>

											<p:outputLabel for="registrationTo"
												value="Registrierung endet am:" style="margin-right:5px" />
											<p:outputPanel style="margin-bottom:5px">
												<p:calendar id="registrationTo"
													value="#{stockMarketGameCreationBean.registrationTo}"
													required="true" size="53" />
											</p:outputPanel>

											<p:outputLabel for="logo" value="Logo:"
												style="margin-right:5px" />
											<p:fileUpload id="logo"
												fileUploadListener="#{stockMarketGameCreationBean.handleLogoUpload}"
												mode="advanced" dragDropSupport="false" update="messages"
												sizeLimit="100000" fileLimit="1"
												allowTypes="/(\.|\/)(gif|jpe?g|png)$/" style="width:396px" />

											<!-- <p:graphicImage value="#{stockMarketGameCreationBean.image}"
										style="max-width:800px;max-height:400px;"
										rendered="#{stockMarketGameCreationBean.logo != null}">
										<f:param name="id"
											value="#{stockMarketGameCreationBean.stockMarketGame.id}" />
									</p:graphicImage>  -->

										</h:panelGrid>
									</p:panel>

								</div>

								<div class="col-md-5">

									<p:panel header="Portfolio-Voreinstellungen">

										<h:panelGrid columns="2" cellpadding="5">

											<p:outputLabel for="startCapital" value="Startkapital(€):"
												style="margin-right:5px" />
											<p:inputText id="startCapital"
												value="#{stockMarketGameCreationBean.startCapital}"
												placeholder="unendlich"
												style="width:220px;margin-bottom:5px">
											</p:inputText>

											<p:outputLabel for="orderFee" value="Ordergebühr(€):"
												style="margin-right:5px" />
											<p:inputText id="orderFee"
												value="#{stockMarketGameCreationBean.orderFee}"
												required="true" style="width:220px;margin-bottom:5px" />

											<p:outputLabel for="portfolioFee" value="Portfoliogebühr(€):"
												style="margin-right:5px" />
											<p:inputText id="portfolioFee"
												value="#{stockMarketGameCreationBean.portfolioFee}"
												required="true" style="width:220px;margin-bottom:5px" />

											<p:outputLabel for="capitalReturnTax"
												value="Kapitalertragssteuer(%):" style="margin-right:5px" />
											<p:inputText id="capitalReturnTax"
												value="#{stockMarketGameCreationBean.capitalReturnTax}"
												required="true" style="width:220px" />

										</h:panelGrid>

										<h:panelGrid columns="2" cellpadding="10"
											style="width: 40%;margin-top:20px">
											<p:commandButton value="Reset" type="reset" />
											<p:commandButton value="Erstellen"
												action="#{stockMarketGameCreationBean.createStockMarketGame()}"
												update="stockmarketgame_create" ajax="true" />
										</h:panelGrid>

									</p:panel>

								</div>
							</div>

						</c:when>

						<c:otherwise>
							<h:outputText
								value="Dieses Börsenspiel kann nur von der Institution, die das Börsenspiel erstellt hat, bearbeitet werden." />
						</c:otherwise>

					</c:choose>

				</c:when>

				<c:otherwise>
					<h:outputText
						value="Börsenspiele können nur von Institutionen erstellt/bearbeitet werden." />
				</c:otherwise>
			</c:choose>

		</h:form>

		<h:form id="allowed_ValuePapers"
			rendered="#{stockMarketGameCreationBean.userInstitution != null and stockMarketGameCreationBean.stockMarketGameAdmin}">

			<div class="row">

				<div class="col-md-12">

					<p:panel header="Erlaubte Wertpapiere">

						<h:panelGrid columns="4" cellpadding="5">

							<p:outputLabel for="valuePaperName" value="Aktienname: "
								style="padding: 10px;" />
							<p:inputText id="valuePaperName"
								value="#{stockMarketGameCreationBean.valuePaperName}"
								style="width:200px" />

							<p:outputLabel for="valuePaperType" value="Wertpapiertyp: "
								style="padding: 10px;margin-left:50px" />
							<p:selectOneMenu id="valuePaperType"
								value="#{stockMarketGameCreationBean.valuePaperType}"
								style="width:200px">
								<f:selectItem itemLabel="Beliebig" itemValue="#{null}" />
								<f:selectItems value="#{valuePaperScreenerBean.valuePaperTypes}"
									var="paperTypes" itemValue="#{paperTypes}"
									itemLabel="#{paperTypes.label}" />
							</p:selectOneMenu>

							<p:outputLabel for="valuePaperCode" value="Code: "
								style="padding: 10px;" />
							<p:inputText id="valuePaperCode"
								value="#{stockMarketGameCreationBean.valuePaperCode}"
								style="width:200px">
								<f:validateRegex
									pattern="^([a-zA-Z]|\?|\*){2}([a-zA-Z0-9]|\?|\*)*" />
							</p:inputText>

							<p:outputLabel for="valuePaperCountry" value="Land: "
								style="padding: 10px;margin-left:50px" />
							<p:selectOneMenu id="valuePaperCountry"
								value="#{stockMarketGameCreationBean.valuePaperCountry}"
								style="width:200px">
								<f:selectItem itemLabel="Beliebig" itemValue="#{null}" />
								<f:selectItems
									value="#{stockMarketGameCreationBean.usedCountries}"
									var="country" itemValue="#{country}" itemLabel="#{country}" />
							</p:selectOneMenu>

							<p:outputLabel for="valuePaperCurrency" value="Währungscode: "
								style="padding: 10px;" />
							<p:selectOneMenu id="valuePaperCurrency"
								value="#{stockMarketGameCreationBean.valuePaperCurrencyCode}"
								style="width:200px">
								<f:selectItem itemLabel="Beliebig" itemValue="#{null}" />
								<f:selectItems
									value="#{stockMarketGameCreationBean.usedCurrencies}"
									var="currencyValue" itemValue="#{currencyValue.currencyCode}"
									itemLabel="#{currencyValue.currencyCode}" />
							</p:selectOneMenu>

							<p:outputLabel for="valuePaperIndex" value="Index: "
								style="padding: 10px;margin-left:50px" />
							<p:selectOneMenu id="valuePaperIndex"
								value="#{stockMarketGameCreationBean.valuePaperIndex}"
								style="width:200px">
								<f:selectItem itemLabel="Beliebig" itemValue="#{null}" />
								<f:selectItems
									value="#{stockMarketGameCreationBean.usedIndexes}" var="index"
									itemValue="#{index}" itemLabel="#{index}" />
							</p:selectOneMenu>

						</h:panelGrid>

						<p:commandButton value="Suche"
							action="#{stockMarketGameCreationBean.searchValuePapers()}"
							update="valuePaperTable" ajax="true" style="margin-right:20px" />

						<p:commandButton value="aktuelle Auswahl hinzufügen"
							action="#{stockMarketGameCreationBean.addSelectedValuePapersToAllowedValuePapers()}"
							update="valuePaperTable allowedValuePapersCount" ajax="true"
							style="margin-right:20px" />

						<p:commandButton value="erlaubte Wertpapiere zurücksetzen"
							action="#{stockMarketGameCreationBean.resetAllowedValuePapers()}"
							update="valuePaperTable allowedValuePapersCount" ajax="true"
							style="margin-right:100px" />

						<h:outputText id="allowedValuePapersCount"
							value="#{'Anzahl erlaubter Wertpapiere: '.concat(stockMarketGameCreationBean.allowedValuePapers.size())}" />


						<p:separator />

						<p:dataTable id="valuePaperTable" var="valuePaper"
							value="#{stockMarketGameCreationBean.searchedValuePapers}"
							rowKey="#{valuePaper.code}"
							selection="#{stockMarketGameCreationBean.selectedAllowedValuePapers}"
							rows="10" paginator="true"
							paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink}">

							<p:column selectionMode="multiple"
								style="width:50px;text-align:center" />

							<p:column headerText="Name" sortBy="#{valuePaper.name}">
								<h:outputText value="#{valuePaper.name}" />
							</p:column>

							<p:column headerText="Währung"
								sortBy="#{valuePaper.currency.currencyCode}">
								<h:outputText
									value="#{valuePaper.currency.currencyCode} (#{valuePaper.currency.symbol})"
									rendered="#{valuePaper.type == 'STOCK' or valuePaper.type == 'FUND'}" />
							</p:column>

							<p:column headerText="Land" sortBy="#{valuePaper.country}">
								<h:outputText value="#{valuePaper.country}"
									rendered="#{valuePaper.type == 'STOCK'}" />
							</p:column>

							<p:column headerText="Index" sortBy="#{valuePaper.index}">
								<h:outputText value="#{valuePaper.index}"
									rendered="#{valuePaper.type == 'STOCK'}" />
							</p:column>

							<p:column headerText="Code" sortBy="#{valuePaper.code}">
								<h:outputText value="#{valuePaper.code}" />
							</p:column>

							<p:column headerText="Typ" sortBy="#{valuePaper.type}">
								<h:outputText value="#{valuePaper.type}" />
							</p:column>

						</p:dataTable>

					</p:panel>

				</div>
			</div>

		</h:form>

	</ui:define>

</ui:composition>
