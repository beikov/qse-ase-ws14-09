<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	template="/WEB-INF/templates/template.xhtml">

	<ui:define name="body">

		<f:metadata>

			<f:viewParam name="stockMarketGameId"
				value="#{stockMarketGameCreationBean.stockMarketGameId}"
				required="false" />
			<f:viewAction action="#{stockMarketGameCreationBean.init()}" />

		</f:metadata>

		<h:form id="stockmarketgame_create" enctype="multipart/form-data">
			<c:choose>
				<c:when
					test="#{stockMarketGameCreationBean.userInstitution != null}">

					<c:choose>
						<c:when test="#{stockMarketGameCreationBean.stockMarketGameAdmin}">

							<p:growl id="messages" showDetail="true" />

							<p:panel header="Börsenspiel-Einstellungen">
								<h:panelGrid columns="3" cellpadding="5">
									<h:outputText value="Börsenspielbezeichnung:" />
									<p:inputText id="name"
										value="#{stockMarketGameCreationBean.name}" required="true">
									</p:inputText>
									<h:message for="name" style="color:red" />

									<h:outputText value="Beschreibung:" />
									<p:inputText id="text"
										value="#{stockMarketGameCreationBean.text}" required="true">
									</p:inputText>
									<h:message for="text" style="color:red" />

									<h:outputText value="Spiel beginnt am:" />
									<p:inputText id="validFrom"
										value="#{stockMarketGameCreationBean.validFrom}"
										required="true">
										<f:convertDateTime pattern="dd.MM.yyyy" timeZone="CET" />
									</p:inputText>
									<h:message for="validFrom" style="color:red" />

									<h:outputText value="Spiel endet am:" />
									<p:inputText id="validTo"
										value="#{stockMarketGameCreationBean.validTo}" required="true">
										<f:convertDateTime pattern="dd.MM.yyyy" timeZone="CET" />
									</p:inputText>
									<h:message for="validTo" style="color:red" />

									<h:outputText value="Registrierung beginnt am:" />
									<p:inputText id="registrationFrom"
										value="#{stockMarketGameCreationBean.registrationFrom}"
										required="true">
										<f:convertDateTime pattern="dd.MM.yyyy" timeZone="CET" />
									</p:inputText>
									<h:message for="registrationFrom" style="color:red" />

									<h:outputText value="Registrierung endet am:" />
									<p:inputText id="registrationTo"
										value="#{stockMarketGameCreationBean.registrationTo}"
										required="true">
										<f:convertDateTime pattern="dd.MM.yyyy" timeZone="CET" />
									</p:inputText>
									<h:message for="registrationTo" style="color:red" />

									<h:outputText value="Logo:" />
									<p:fileUpload
										fileUploadListener="#{stockMarketGameCreationBean.handleLogoUpload}"
										mode="advanced" dragDropSupport="false" update="messages"
										sizeLimit="100000" fileLimit="1"
										allowTypes="/(\.|\/)(gif|jpe?g|png)$/" />

									<!-- <p:graphicImage value="#{stockMarketGameCreationBean.image}"
										style="max-width:800px;max-height:400px;"
										rendered="#{stockMarketGameCreationBean.logo != null}">
										<f:param name="id"
											value="#{stockMarketGameCreationBean.stockMarketGame.id}" />
									</p:graphicImage>  -->

								</h:panelGrid>
							</p:panel>

							<p:panel header="Portfolio-Voreinstellungen">

								<h:panelGrid columns="3" cellpadding="5">

									<h:outputText value="Startkapital(€): " />
									<p:inputText id="startCapital"
										value="#{stockMarketGameCreationBean.startCapital}"
										placeholder="unendlich">
									</p:inputText>
									<h:message for="startCapital" style="color:red" />

									<h:outputText value="Ordergebühr(€): " />
									<p:inputText id="orderFee"
										value="#{stockMarketGameCreationBean.orderFee}"
										required="true" />
									<h:message for="orderFee" style="color:red" />

									<h:outputText value="Portfoliogebühr(€): " />
									<p:inputText id="portfolioFee"
										value="#{stockMarketGameCreationBean.portfolioFee}"
										required="true" />
									<h:message for="portfolioFee" style="color:red" />

									<h:outputText value="Kapitalertragssteuer(%): " />
									<p:inputText id="capitalReturnTax"
										value="#{stockMarketGameCreationBean.capitalReturnTax}"
										required="true" />
									<h:message for="capitalReturnTax" style="color:red" />

								</h:panelGrid>

								<h:panelGrid columns="2" cellpadding="10" style="width: 40%">
									<!-- <p:commandButton value="Reset" type="reset" /> -->
									<p:commandButton value="Erstellen"
										action="#{stockMarketGameCreationBean.createStockMarketGame()}"
										update="stockmarketgame_create" ajax="true" />
								</h:panelGrid>

							</p:panel>

						</c:when>

						<c:otherwise>
							<h:outputText
								value="Dieses Börsenspiel kann nur von der Institution, die das Börsenspiel erstellt hat, bearbeitet werden." />
						</c:otherwise>

					</c:choose>

				</c:when>

				<c:otherwise>
					<h:outputText
						value="Börsenspiele können nur von Institutionen erstellt/bearbeitet werden." />
				</c:otherwise>
			</c:choose>

		</h:form>

		<h:form id="allowed_ValuePapers"
			rendered="#{stockMarketGameCreationBean.userInstitution != null and stockMarketGameCreationBean.stockMarketGameAdmin}">

			<p:panel header="erlaubte Wertpapiere">

				<h:panelGrid columns="4" cellpadding="5">

					<p:outputLabel for="valuePaperName" value="Aktienname: "
						style="padding: 10px;" />
					<p:inputText id="valuePaperName"
						value="#{stockMarketGameCreationBean.valuePaperName}" />

					<p:outputLabel for="valuePaperType" value="Aktientyp: "
						style="padding: 10px;" />
					<p:selectOneMenu id="valuePaperType"
						value="#{stockMarketGameCreationBean.valuePaperType}"
						style="width:200px">
						<f:selectItem itemLabel="Beliebig" itemValue="#{null}" />
						<f:selectItems value="#{valuePaperScreenerBean.valuePaperTypes}"
							var="paperTypes" itemValue="#{paperTypes}"
							itemLabel="#{paperTypes.label}" />
					</p:selectOneMenu>

					<p:outputLabel for="valuePaperCode" value="Code: "
						style="padding: 10px;" />
					<p:inputText id="valuePaperCode"
						value="#{stockMarketGameCreationBean.valuePaperCode}">
						<f:validateRegex
							pattern="^([a-zA-Z]|\?|\*){2}([a-zA-Z0-9]|\?|\*)*" />
					</p:inputText>

					<p:outputLabel for="valuePaperCountry" value="Land: "
						style="padding: 10px;" />
					<p:selectOneMenu id="valuePaperCountry"
						value="#{stockMarketGameCreationBean.valuePaperCountry}"
						style="width:100px;margin:5px;">
						<f:selectItem itemLabel="Beliebig" itemValue="#{null}" />
						<f:selectItems
							value="#{stockMarketGameCreationBean.usedCountries}"
							var="country" itemValue="#{country}" itemLabel="#{country}" />
					</p:selectOneMenu>

					<p:outputLabel for="valuePaperCurrency" value="Währungscode: "
						style="padding: 10px;" />
					<p:selectOneMenu id="valuePaperCurrency"
						value="#{stockMarketGameCreationBean.valuePaperCurrencyCode}"
						style="width:100px;margin:5px;">
						<f:selectItem itemLabel="Beliebig" itemValue="#{null}" />
						<f:selectItems
							value="#{stockMarketGameCreationBean.usedCurrencies}"
							var="currencyValue" itemValue="#{currencyValue.currencyCode}"
							itemLabel="#{currencyValue.currencyCode}" />
					</p:selectOneMenu>

					<p:outputLabel for="valuePaperIndex" value="Index: "
						style="padding: 10px;" />
					<p:selectOneMenu id="valuePaperIndex"
						value="#{stockMarketGameCreationBean.valuePaperIndex}"
						style="width:100px;margin:5px;">
						<f:selectItem itemLabel="Beliebig" itemValue="#{null}" />
						<f:selectItems
							value="#{stockMarketGameCreationBean.usedIndexes}"
							var="index" itemValue="#{index}"
							itemLabel="#{index}" />
					</p:selectOneMenu>

				</h:panelGrid>

				<p:commandButton value="Suche"
					action="#{stockMarketGameCreationBean.searchValuePapers()}"
					update="valuePaperTable" ajax="true" />


				<p:separator />

				<p:dataTable id="valuePaperTable" var="valuePaper"
					value="#{stockMarketGameCreationBean.searchedValuePapers}">

					<p:column headerText="Name" sortBy="#{valuePaper.name}">
						<h:outputText value="#{valuePaper.name}" />
					</p:column>

					<p:column headerText="Währung"
						sortBy="#{valuePaper.currency.currencyCode}">
						<h:outputText
							value="#{valuePaper.currency.currencyCode} (#{valuePaper.currency.symbol})"
							rendered="#{valuePaper.type == 'STOCK' or valuePaper.type == 'FUND'}" />
					</p:column>

					<p:column headerText="Land" sortBy="#{valuePaper.country}">
						<h:outputText value="#{valuePaper.country}"
							rendered="#{valuePaper.type == 'STOCK'}" />
					</p:column>
					
					<p:column headerText="Index" sortBy="#{valuePaper.index}">
						<h:outputText value="#{valuePaper.index}"
							rendered="#{valuePaper.type == 'STOCK'}" />
					</p:column>

					<p:column headerText="Code" sortBy="#{valuePaper.code}">
						<h:outputText value="#{valuePaper.code}" />
					</p:column>

					<p:column headerText="Typ" sortBy="#{valuePaper.type}">
						<h:outputText value="#{valuePaper.type}" />
					</p:column>

				</p:dataTable>

				<p:messages autoUpdate="true" />

			</p:panel>

		</h:form>

	</ui:define>

</ui:composition>
