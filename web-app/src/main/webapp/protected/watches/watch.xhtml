<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:ase="http://java.sun.com/jsf/composite/portfolio"
	template="/WEB-INF/templates/template.xhtml">
	
	<ui:define name="body">
		<h:form id="form">
			<p:commandButton value="Neuen Ausdruck anlegen" actionListener="#{watchBean.newWatch()}" process="@this" update="@form"/>
			
			<p:separator />
		
			<p:dataTable id="watchTable" value="#{watches}" var="watch" selectionMode="single" selection="#{watchBean.selectedWatch}" emptyMessage="Keine Eintr채ge gefunden">
			
				<p:ajax event="rowSelect"/>
				<p:ajax event="rowUnselect"/>
			
				<p:column headerText="Erstellungsdatum">
					<h:outputText value="#{watch.created.time}">
						<f:convertDateTime type="both" dateStyle="medium" timeStyle="medium"/>
					</h:outputText>
				</p:column>
				<p:column headerText="Wertpapier">
					<h:outputText value="#{watch.valuePaper.name}"/>
				</p:column>
				<p:column headerText="Ausdruck">
					<h:outputText value="#{watch.expression}"/>
				</p:column>
			</p:dataTable>
			
			<p:separator />
			
			<h:panelGrid columns="2" cellpadding="10">		
				<p:outputLabel for="stock" value="W채hle Aktie: " style="padding: 10px;"/>
				<p:selectOneMenu id="stock" value="#{watchBean.selectedWatch.valuePaper}" style="width:200px"
					converter="#{stockConverter}"
					required="true" requiredMessage="Bitte ausw채hlen!">
					<f:selectItem itemLabel="Bitte ausw채hlen" itemValue="#{null}" />
					<f:selectItems value="#{stockItems}"/>
				</p:selectOneMenu>
			</h:panelGrid>
		
			<p:tabView id="watchTabView" activeIndex="#{watchBean.activeIndex}">
			
        		<p:ajax event="tabChange"/>
			
				<p:tab id="simple" title="Einfach" disabled="#{watchBean.advancedOnly}" titletip="#{watchBean.advancedOnly ? 'Der Ausdruck ist zu kompliziert um im einfachen Modus bearbeitet zu werden!' : ''}">
					<ase:filterEditor id="filterEditor" model="#{watchBean.filterModel}" />
				</p:tab>
				
				<p:tab id="advanced" title="Erweitert">
					<ase:expressionEditor id="watchEditor" value="#{watchBean.watchExpression}" expressionValidator="#{watchValidator}"/>
					<p:message for="watchEditor:expressionEditor" showSummary="true" showDetail="false"/>
				</p:tab>
			</p:tabView>
			
			<p:separator />
			
			<p:commandButton value="#{empty watchBean.selectedWatch.id ? 'Erstellen' : 'Speichern'}" ajax="false" actionListener="#{watchBean.saveWatch()}"/>
		
		</h:form>
	</ui:define>
	
</ui:composition>
